using SpecialFunctions


const sqrtpi = sqrt(Ï€)
function boys!(mmax, T, F)
    if mmax < 5
        if T > 1.0
            boys_increment!(mmax, T, F)
        else
            boys_decrement!(mmax, T, F)
        end
    else
        error("boys was not implemented for m = $(mmax)")
    end
end
            
function boys_increment!(mmax, T, F)
    sqrtT = sqrt(T)
    if T > 35.0
        F[1] = 0.5 * sqrtpi / sqrtT
    else
        F[1] = sqrtpi * erf(sqrtT) * 0.5 / sqrtT
    end
    expmT = exp(-T)
    oo2T = 0.5 / T
    for m=1:mmax
        F[m+1] = ((2m-1) * F[m] - expmT) * oo2T
    end
end

function boys_decrement!(mmax, T, F)
    F[mmax+1] = boys_Maclaurin15(mmax, T)
    for m=mmax-1:-1:0
        F[m+1] = (2T * F[m+2] + exp(-T)) / (2m + 1)
    end
end

function boys_Maclaurin15(m, T)
    if m == 0
        1. + T*(-0.3333333333333333 + 
      T*(0.1 + T*(-0.023809523809523808 + 
            T*(0.004629629629629629 + 
               T*(-0.0007575757575757576 + 
                  T*(0.00010683760683760684 + 
                     T*(-0.000013227513227513228 + 
                        T*(1.4589169000933706e-6 + 
                          T*(-1.4503852223150468e-7 + 
                          T*(1.3122532963802806e-8 + 
                          T*(-1.0892221037148573e-9 + 
                          T*(8.35070279514724e-11 + 
                          T*(-5.9477940136376354e-12 + 
                          (3.9554295164585257e-13 - 
                          2.466827010264457e-14*T)*T)))))))))))))
    elseif m == 1
        0.3333333333333333 + T*(-0.2 + 
      T*(0.07142857142857142 + 
         T*(-0.018518518518518517 + 
            T*(0.003787878787878788 + 
               T*(-0.000641025641025641 + 
                  T*(0.00009259259259259259 + 
                     T*(-0.000011671335200746965 + 
                        T*(1.3053467000835422e-6 + 
                          T*(-1.3122532963802806e-7 + 
                          T*(1.1981443140863431e-8 + 
                          T*(-1.0020843354176688e-9 + 
                          T*(7.732132217728926e-11 + 
                          T*(-5.537601323041936e-12 + 
                          (3.7002405153966856e-13 - 
                          2.317322342975702e-14*T)*T)))))))))))))
    elseif m == 2
        0.2 + T*(-0.14285714285714285 + 
      T*(0.05555555555555555 + 
         T*(-0.015151515151515152 + 
            T*(0.003205128205128205 + 
               T*(-0.0005555555555555556 + 
                  T*(0.00008169934640522875 + 
                     T*(-0.000010442773600668338 + 
                        T*(1.1810279667422524e-6 + 
                          T*(-1.198144314086343e-7 + 
                          T*(1.1022927689594356e-8 + 
                          T*(-9.278558661274711e-10 + 
                          T*(7.198881719954517e-11 + 
                          T*(-5.18033672155536e-12 + 
                          (3.475983514463553e-13 - 
                          2.1849039233770904e-14*T)*T)))))))))))))
    elseif m == 3
        0.14285714285714285 + T*(-0.1111111111111111 + 
      T*(0.045454545454545456 + 
         T*(-0.01282051282051282 + 
            T*(0.002777777777777778 + 
               T*(-0.0004901960784313725 + 
                  T*(0.00007309941520467836 + 
                     T*(-9.44822373393802e-6 + 
                        T*(1.0783298826777088e-6 + 
                          T*(-1.1022927689594356e-7 + 
                          T*(1.0206414527402181e-8 + 
                          T*(-8.63865806394542e-10 + 
                          T*(6.734437738021968e-11 + 
                          T*(-4.866376920248974e-12 + 
                          (3.2773558850656355e-13 - 
                          2.0668010085999505e-14*T)*T)))))))))))))
    elseif m == 4
        0.1111111111111111 + T*(-0.09090909090909091 + 
      T*(0.038461538461538464 + 
         T*(-0.011111111111111112 + 
            T*(0.0024509803921568627 + 
               T*(-0.0004385964912280702 + 
                  T*(0.00006613756613756614 + 
                     T*(-8.62663906142167e-6 + 
                        T*(9.92063492063492e-7 + 
                          T*(-1.0206414527402182e-7 + 
                          T*(9.502523870339963e-9 + 
                          T*(-8.08132528562636e-10 + 
                          T*(6.326289996323666e-11 + 
                          T*(-4.58829823909189e-12 + 
                          (3.1002015128999257e-13 - 
                          1.9608112132871323e-14*T)*T)))))))))))))
    else
        error("boys_series15 not implemented for m = $(m)")
    end
end